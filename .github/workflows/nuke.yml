name: Cluster Nuke

on:
  workflow_dispatch:         # âœ… Allow manual run from GitHub UI
  schedule:
    - cron: '52 10 * * *'     # âœ… Runs daily at 4:22 PM IST (10:52 UTC)

jobs:
  nuke:
    name: Nuke test namespace
    runs-on: self-hosted     # âœ… Uses your local runner (Minikube access)

    steps:
    - name: Nuke all resources in test namespace
      run: |
        echo "ðŸ”¥ Nuking test namespace at $(date)"
        kubectl delete all --all -n test
        kubectl delete ingress --all -n test --ignore-not-found
        kubectl delete configmap --all -n test --ignore-not-found
        kubectl delete secret --all -n test --ignore-not-found
        echo "âœ… Nuke complete"
